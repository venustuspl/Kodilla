
create table stats(
STAT_ID INT(11) AUTO_INCREMENT,
STAT_DATE DATETIME NOT NULL,
STAT VARCHAR(20) NOT NULL,
VALUE INT(11) NOT NULL,
PRIMARY KEY(STAT_ID) );

CREATE VIEW BESTSELLERS_COUNT AS
SELECT COUNT(*) FROM BOOKS
WHERE
BESTSELLER = TRUE;

SELECT * FROM BESTSELLERS_COUNT;

DELIMITER $

CREATE EVENT UPDATE_BESTSELLER_STATS
   ON SCHEDULE EVERY 1 MINUTE
   DO
   BEGIN
       DECLARE BESTSELLERCOUNT INT DEFAULT 0;

       CALL UpdateBestsellerS();

       SET BESTSELLERCOUNT = 'SELECT * FROM BESTSELLERS_COUNT';
       INSERT INTO stats (STAT_DATE, STAT, VALUE) VALUE (CURDATE(), 'BESTSELLERS',BESTSELLERCOUNT);
   END $

DELIMITER  ;

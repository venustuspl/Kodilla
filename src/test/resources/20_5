
create table stats(
STAT_ID INT(11) AUTO_INCREMENT,
STAT_DATE DATETIME NOT NULL,
STAT VARCHAR(20) NOT NULL,
VALUE INT(11) NOT NULL,
PRIMARY KEY(STAT_ID) );

CREATE VIEW BESTSELLERS_COUNT AS
SELECT COUNT(*) FROM BOOKS
WHERE
BESTSELLER = TRUE;

SELECT * FROM BESTSELLERS_COUNT;

DELIMITER $

CREATE EVENT UPDATE_BESTSELLER_STATS
    ON SCHEDULE EVERY 1 MINUTE
    DO
    BEGIN
        DECLARE BESTSELLERCOUNT INT DEFAULT 0;

        CALL UpdateBestsellerS();

        SELECT * FROM BESTSELLERS_COUNT INTO BESTSELLERCOUNT;
        INSERT INTO stats (STAT_DATE, STAT, VALUE) VALUE (CURRENT_TIMESTAMP, 'BESTSELLERS', BESTSELLERCOUNT);
    END $
DELIMITER  ;
